<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
         <!-- üöÄ PWA META TAGS -->
     <meta name="theme-color" content="#4CAF50">
     <meta name="mobile-web-app-capable" content="yes">
     <meta name="apple-mobile-web-app-capable" content="yes">
     <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
     <meta name="apple-mobile-web-app-title" content="Fulbito">
     <meta name="msapplication-TileColor" content="#4CAF50">
     <meta name="msapplication-config" content="/browserconfig.xml">
     <meta name="application-name" content="Fulbito">
     <meta name="msapplication-TileImage" content="/img/icons/icon-144x144.png">
     
     <!-- üöÄ PWA CR√çTICO PARA CHROME -->
     <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
     <meta name="format-detection" content="telephone=no">
     <meta name="msapplication-tap-highlight" content="no">
    
    <!-- üöÄ PWA MANIFEST -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- üöÄ PWA ICONS -->
    <link rel="icon" type="image/png" sizes="32x32" href="/img/icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/img/icons/icon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/img/icons/icon-180x180.png">
    
    <title>Fulbito - Organizador de Partidos de F√∫tbol</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- üöÄ PWA STYLES -->
    <style>
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4rem 0;
        }
        .feature-card {
            transition: transform 0.3s ease;
            border: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .feature-card:hover {
            transform: translateY(-5px);
        }
        .stats-card {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
        }
        .btn-custom {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
            color: white;
        }
        
        /* üöÄ PWA INSTALL BUTTON STYLES */
        .pwa-install-btn {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 1000;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
            transition: all 0.3s ease;
            display: none;
        }
        .pwa-install-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
            color: white;
        }
        
        /* üöÄ PWA STATUS INDICATOR */
        .pwa-status {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: none;
        }
        .pwa-status.online {
            background: #4CAF50;
            color: white;
        }
        .pwa-status.offline {
            background: #f44336;
            color: white;
        }
        
        /* üöÄ MOBILE OPTIMIZATIONS */
        @media (max-width: 768px) {
            .pwa-install-btn {
                top: 70px;
                right: 15px;
                padding: 10px 16px;
                font-size: 14px;
            }
            .pwa-status {
                top: 15px;
                right: 15px;
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <!-- üöÄ PWA STATUS INDICATOR -->
    <div id="pwa-status" class="pwa-status">
        <i class="fas fa-circle me-1"></i>
        <span id="pwa-status-text">Online</span>
    </div>
    
    <!-- üöÄ PWA INSTALL BUTTON -->
    <button id="pwa-install-btn" class="pwa-install-btn">
        <i class="fas fa-download me-2"></i>Instalar App
    </button>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <img src="/img/logo.png" alt="Fulbito Logo" height="45">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/jugadores">
                            <i class="fas fa-users me-1"></i>Jugadores
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/equipos/formar">
                            <i class="fas fa-random me-1"></i>Formar Equipos
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/partidos/historial">
                            <i class="fas fa-history me-1"></i>Historial
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container text-center">
            <h1 class="display-4 fw-bold mb-4">
                <i class="fas fa-futbol me-3"></i>Fulbito
            </h1>
            <p class="lead mb-4">Organiza partidos de f√∫tbol de manera inteligente y justa</p>
            <p class="mb-5">Crea equipos balanceados bas√°ndose en las habilidades de cada jugador</p>
            <div class="d-flex justify-content-center gap-3 flex-wrap">
                <a href="/jugador/nuevo" class="btn btn-custom btn-lg">
                    <i class="fas fa-plus me-2"></i>Agregar Jugador
                </a>
                <a href="/equipos/formar" class="btn btn-success btn-lg">
                    <i class="fas fa-random me-2"></i>Formar Equipos
                </a>
            </div>
            
            <!-- üöÄ BOT√ìN MANUAL DE INSTALACI√ìN PWA -->
            <div class="text-center mt-4" id="pwa-install-section" style="display: none;">
              <button 
                id="pwa-install-button" 
                class="btn btn-warning btn-lg px-4 py-3"
                onclick="handleManualInstallBasic()"
                style="background: linear-gradient(135deg, #ffc107, #ff8f00); border: none; box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);">
                <i class="fas fa-download me-2"></i>
                üì± Instalar App Fulbito
              </button>
              <p class="text-white mt-2 mb-0" style="font-size: 0.9rem; opacity: 0.9;">
                Instala Fulbito como app nativa en tu dispositivo
              </p>
            </div>
        </div>
    </section>

    <!-- Estad√≠sticas -->
    <section class="py-5">
        <div class="container">
            <h2 class="text-center mb-5">Estad√≠sticas del Sistema</h2>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="card stats-card text-center h-100">
                        <div class="card-body">
                            <i class="fas fa-users fa-3x mb-3"></i>
                            <h3 class="card-title" id="totalJugadores">0</h3>
                            <p class="card-text">Jugadores Registrados</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card stats-card text-center h-100">
                        <div class="card-body">
                            <i class="fas fa-shield-alt fa-3x mb-3"></i>
                            <h3 class="card-title" id="totalArqueros">0</h3>
                            <p class="card-text">Arqueros Disponibles</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card stats-card text-center h-100">
                        <div class="card-body">
                            <i class="fas fa-trophy fa-3x mb-3"></i>
                            <h3 class="card-title" id="totalPartidos">0</h3>
                            <p class="card-text">Partidos Jugados</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Caracter√≠sticas -->
    <section class="py-5 bg-light">
        <div class="container">
            <h2 class="text-center mb-5">¬øPor qu√© elegir Fulbito?</h2>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="card feature-card h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-balance-scale fa-3x text-primary mb-3"></i>
                            <h5 class="card-title">Equipos Balanceados</h5>
                            <p class="card-text">Nuestro algoritmo inteligente forma equipos equilibrados bas√°ndose en las habilidades de cada jugador.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card feature-card h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-random fa-3x text-success mb-3"></i>
                            <h5 class="card-title">Formaci√≥n Aleatoria</h5>
                            <p class="card-text">Cada partido tiene equipos diferentes, asegurando que todos jueguen con diferentes compa√±eros.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card feature-card h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-chart-line fa-3x text-info mb-3"></i>
                            <h5 class="card-title">Sistema de Calificaci√≥n</h5>
                            <p class="card-text">Cada jugador tiene un perfil completo con calificaciones en velocidad, habilidad, fuerza, tiro y t√°ctica.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- C√≥mo funciona -->
    <section class="py-5">
        <div class="container">
            <h2 class="text-center mb-5">¬øC√≥mo funciona?</h2>
            <div class="row g-4">
                <div class="col-md-3 text-center">
                    <div class="mb-3">
                        <i class="fas fa-user-plus fa-2x text-primary"></i>
                    </div>
                    <h6>1. Agrega Jugadores</h6>
                    <p class="small">Registra a todos los jugadores con sus habilidades</p>
                </div>
                <div class="col-md-3 text-center">
                    <div class="mb-3">
                        <i class="fas fa-cog fa-2x text-success"></i>
                    </div>
                    <h6>2. Configura el Partido</h6>
                    <p class="small">Especifica cu√°ntos jugadores participar√°n</p>
                </div>
                <div class="col-md-3 text-center">
                    <div class="mb-3">
                        <i class="fas fa-magic fa-2x text-info"></i>
                    </div>
                    <h6>3. Genera Equipos</h6>
                    <p class="small">Nuestro algoritmo forma equipos balanceados</p>
                </div>
                <div class="col-md-3 text-center">
                    <div class="mb-3">
                        <i class="fas fa-futbol fa-2x text-warning"></i>
                    </div>
                    <h6>4. ¬°A Jugar!</h6>
                    <p class="small">Disfruta de partidos justos y divertidos</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-dark text-light py-4">
        <div class="container text-center">
            <p class="mb-0">&copy; 2025 Fulbito - Organizador de Partidos de F√∫tbol - creado por Gustavo G√≥mez Lucero</p>
        </div>
    </footer>

    <!-- üöÄ BOOTSTRAP & EXTERNAL SCRIPTS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- üöÄ PWA JAVASCRIPT FILES -->
    <script src="/js/offline-manager.js"></script>
    <script src="/js/pwa-installer.js"></script>
    <script src="/js/mobile-features.js"></script>
    <script src="/js/pwa-main.js"></script>
    
    <!-- üöÄ SCRIPT OFFLINE COMPLETO -->
    <script>
        // üöÄ VARIABLES GLOBALES
        let estadisticas = {
            totalJugadores: 0,
            totalArqueros: 0,
            totalPartidos: 0
        };
        
        // üöÄ INICIALIZACI√ìN AL CARGAR LA P√ÅGINA
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üöÄ Inicializando p√°gina principal en modo offline...');
            
            // üöÄ REGISTRAR SERVICE WORKER INMEDIATAMENTE
            registerServiceWorker();
            
            // üöÄ MOSTRAR BOT√ìN MANUAL DE INSTALACI√ìN INMEDIATAMENTE
            showManualInstallButtonImmediately();
            
            // üöÄ INTENTAR INICIALIZAR PWA (PERO NO BLOQUEAR)
            try {
                await waitForPWAComponents();
                console.log('‚úÖ PWA inicializada correctamente');
                
                // üöÄ CARGAR ESTAD√çSTICAS DESPU√âS DE QUE PWA EST√â LISTA
                await cargarEstadisticasOffline();
                actualizarUI();
                
            } catch (error) {
                console.warn('‚ö†Ô∏è PWA no disponible, continuando en modo b√°sico:', error);
                // üöÄ CARGAR ESTAD√çSTICAS POR DEFECTO
                cargarEstadisticasPorDefecto();
            }
        });
        
        // üöÄ REGISTRAR SERVICE WORKER
        async function registerServiceWorker() {
            try {
                if ('serviceWorker' in navigator) {
                    console.log('üöÄ Registrando Service Worker...');
                    
                    const registration = await navigator.serviceWorker.register('/sw.js', {
                        scope: '/'
                    });
                    
                    console.log('‚úÖ Service Worker registrado exitosamente:', registration);
                    
                    // üöÄ VERIFICAR ESTADO DE INSTALACI√ìN
                    if (registration.installing) {
                        console.log('üì± Service Worker instalando...');
                    } else if (registration.waiting) {
                        console.log('‚è≥ Service Worker esperando...');
                    } else if (registration.active) {
                        console.log('‚úÖ Service Worker activo');
                    }
                    
                    // üöÄ ESCUCHAR EVENTOS DE INSTALACI√ìN PWA
                    setupPWAInstallListeners();
                    
                } else {
                    console.warn('‚ö†Ô∏è Service Worker no soportado en este navegador');
                }
            } catch (error) {
                console.error('‚ùå Error registrando Service Worker:', error);
            }
        }
        
        // üöÄ CONFIGURAR EVENTOS DE INSTALACI√ìN PWA
        function setupPWAInstallListeners() {
            console.log('üöÄ Configurando eventos de instalaci√≥n PWA...');
            
            // üéØ ESCUCHAR PROMPT DE INSTALACI√ìN
            window.addEventListener('beforeinstallprompt', (event) => {
                console.log('üì± PROMPT DE INSTALACI√ìN PWA DETECTADO!');
                
                // üéØ PREVENIR QUE SE MUESTRE AUTOM√ÅTICAMENTE
                event.preventDefault();
                
                // üéØ GUARDAR EL EVENTO
                window.deferredPrompt = event;
                
                // üéØ MOSTRAR BOT√ìN DE INSTALACI√ìN AUTOM√ÅTICA
                showAutomaticInstallButton();
                
                console.log('‚úÖ Prompt de instalaci√≥n PWA configurado correctamente');
            });
            
            // üéØ ESCUCHAR APP INSTALADA
            window.addEventListener('appinstalled', (event) => {
                console.log('‚úÖ Fulbito instalado como PWA exitosamente!');
                
                // üéØ LIMPIAR PROMPT
                window.deferredPrompt = null;
                
                // üéØ OCULTAR BOT√ìN DE INSTALACI√ìN
                hideInstallButton();
                
                // üéØ MOSTRAR MENSAJE DE √âXITO
                showInstallationSuccess();
            });
            
            // üéØ ESCUCHAR MENSAJES DEL SERVICE WORKER
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.addEventListener('message', (event) => {
                    console.log('üì± Mensaje recibido del Service Worker:', event.data);
                    
                    if (event.data.type === 'PWA_INSTALL_PROMPT_AVAILABLE') {
                        console.log('üöÄ PROMPT DE INSTALACI√ìN PWA DISPONIBLE V√çA SERVICE WORKER!');
                        
                        // üéØ MOSTRAR BOT√ìN DE INSTALACI√ìN AUTOM√ÅTICA
                        showAutomaticInstallButton();
                    }
                });
            }
            
            console.log('‚úÖ Eventos de instalaci√≥n PWA configurados');
        }
        
        // üöÄ MOSTRAR BOT√ìN DE INSTALACI√ìN AUTOM√ÅTICA
        function showAutomaticInstallButton() {
            console.log('üöÄ Mostrando bot√≥n de instalaci√≥n autom√°tica...');
            
            const installSection = document.getElementById('pwa-install-section');
            if (installSection) {
                // üéØ CAMBIAR EL BOT√ìN PARA USAR INSTALACI√ìN AUTOM√ÅTICA
                installSection.innerHTML = `
                    <button 
                        id="pwa-install-button" 
                        class="btn btn-success btn-lg px-4 py-3"
                        onclick="installPWAAutomatically()"
                        style="background: linear-gradient(135deg, #28a745, #20c997); border: none; box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);">
                        <i class="fas fa-download me-2"></i>
                        üöÄ Instalar Fulbito como App
                    </button>
                    <p class="text-white mt-2 mb-0" style="font-size: 0.9rem; opacity: 0.9;">
                        Chrome detect√≥ que Fulbito es instalable como PWA
                    </p>
                `;
                
                console.log('‚úÖ Bot√≥n de instalaci√≥n autom√°tica visible');
            }
        }
        
        // üöÄ INSTALAR PWA AUTOM√ÅTICAMENTE
        async function installPWAAutomatically() {
            console.log('üöÄ Iniciando instalaci√≥n autom√°tica de PWA...');
            
            if (!window.deferredPrompt) {
                console.warn('‚ö†Ô∏è No hay prompt de instalaci√≥n disponible');
                return;
            }
            
            try {
                // üéØ MOSTRAR PROMPT DE INSTALACI√ìN
                window.deferredPrompt.prompt();
                
                // üéØ ESPERAR RESPUESTA DEL USUARIO
                const { outcome } = await window.deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    console.log('‚úÖ Usuario acept√≥ la instalaci√≥n autom√°tica');
                } else {
                    console.log('‚ùå Usuario rechaz√≥ la instalaci√≥n autom√°tica');
                }
                
                // üéØ LIMPIAR PROMPT
                window.deferredPrompt = null;
                
            } catch (error) {
                console.error('‚ùå Error en instalaci√≥n autom√°tica:', error);
            }
        }
        
        // üöÄ OCULTAR BOT√ìN DE INSTALACI√ìN
        function hideInstallButton() {
            const installSection = document.getElementById('pwa-install-section');
            if (installSection) {
                installSection.style.display = 'none';
                console.log('‚úÖ Bot√≥n de instalaci√≥n oculto');
            }
        }
        
        // üöÄ MOSTRAR MENSAJE DE √âXITO
        function showInstallationSuccess() {
            const successMessage = `
                <div class="alert alert-success" role="alert" style="margin: 20px;">
                    <h5>üéâ ¬°Fulbito Instalado Exitosamente!</h5>
                    <p>Ya puedes acceder a Fulbito desde tu pantalla de inicio</p>
                    <p>La app funcionar√° offline y se actualizar√° autom√°ticamente</p>
                    <button onclick="this.parentElement.remove()" class="btn btn-success mt-2">¬°Perfecto!</button>
                </div>
            `;
            
            const installSection = document.getElementById('pwa-install-section');
            if (installSection) {
                installSection.innerHTML = successMessage;
            }
        }
        
        // üöÄ ESPERAR COMPONENTES PWA
        async function waitForPWAComponents() {
            const maxWaitTime = 15000; // 15 segundos
            const checkInterval = 100; // 100ms
            let elapsedTime = 0;
            
            while (elapsedTime < maxWaitTime) {
                if (window.offlineManager && window.pwaInstaller && window.mobileFeatures) {
                    console.log('‚úÖ Todos los componentes PWA est√°n listos');
                    return true;
                }
                
                await new Promise(resolve => setTimeout(resolve, checkInterval));
                elapsedTime += checkInterval;
            }
            
            console.warn('‚ö†Ô∏è Timeout esperando componentes PWA, continuando sin ellos');
            return false;
        }
        
        // üöÄ MOSTRAR BOT√ìN MANUAL INMEDIATAMENTE (SIN ESPERAR PWA)
        function showManualInstallButtonImmediately() {
            console.log('üöÄ Mostrando bot√≥n manual de instalaci√≥n inmediatamente...');
            const installSection = document.getElementById('pwa-install-section');
            if (installSection) {
                installSection.style.display = 'block';
                console.log('‚úÖ Bot√≥n manual de instalaci√≥n visible inmediatamente');
                
                // üöÄ CONFIGURAR CLICK HANDLER B√ÅSICO INMEDIATAMENTE
                const installButton = document.getElementById('pwa-install-button');
                if (installButton) {
                    // üöÄ AGREGAR EVENT LISTENER ADICIONAL COMO RESPALDO
                    installButton.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('üöÄ Bot√≥n manual clickeado - ejecutando funci√≥n b√°sica...');
                        handleManualInstallBasic();
                    });
                    
                    console.log('‚úÖ Click handler b√°sico configurado y funcionando');
                }
            } else {
                console.warn('‚ö†Ô∏è No se encontr√≥ la secci√≥n de instalaci√≥n manual');
            }
        }
        
        // üöÄ MANEJAR INSTALACI√ìN MANUAL B√ÅSICA (SIN PWA)
        function handleManualInstallBasic() {
            console.log('üöÄ Bot√≥n manual clickeado - mostrando instrucciones b√°sicas...');
            
            const isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent);
            const isAndroid = /Android/.test(navigator.userAgent);
            const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            let instructions = '';
            
            if (isIOS) {
                instructions = `
                    <div class="alert alert-info" role="alert" style="margin: 20px;">
                        <h5>üì± Instalar en iPhone/iPad:</h5>
                        <ol>
                            <li>Toca el bot√≥n <strong>Compartir</strong> (‚ñ°‚Üë) en Safari</li>
                            <li>Selecciona <strong>"A√±adir a pantalla de inicio"</strong></li>
                            <li>Toca <strong>"A√±adir"</strong></li>
                        </ol>
                        <button onclick="this.parentElement.remove()" class="btn btn-primary mt-2">Entendido</button>
                    </div>
                `;
            } else if (isAndroid) {
                instructions = `
                    <div class="alert alert-info" role="alert" style="margin: 20px;">
                        <h5>üì± Instalar en Android:</h5>
                        <ol>
                            <li>Toca el men√∫ (‚ãÆ) en Chrome</li>
                            <li>Selecciona <strong>"Instalar aplicaci√≥n"</strong></li>
                            <li>Toca <strong>"Instalar"</strong></li>
                        </ol>
                        <button onclick="this.parentElement.remove()" class="btn btn-primary mt-2">Entendido</button>
                    </div>
                `;
            } else if (isMobile) {
                instructions = `
                    <div class="alert alert-info" role="alert" style="margin: 20px;">
                        <h5>üì± Instalar en m√≥vil:</h5>
                        <ol>
                            <li>Busca el icono de instalaci√≥n (üì•) en la barra de direcciones</li>
                            <li>O toca el men√∫ del navegador y busca "Instalar app"</li>
                        </ol>
                        <button onclick="this.parentElement.remove()" class="btn btn-primary mt-2">Entendido</button>
                    </div>
                `;
            } else {
                instructions = `
                    <div class="alert alert-info" role="alert" style="margin: 20px;">
                        <h5>üíª Instalar en PC:</h5>
                        <ol>
                            <li>Busca el icono de instalaci√≥n (üì•) en la barra de direcciones</li>
                            <li>O usa <strong>Ctrl+Shift+I</strong> y busca "Install"</li>
                        </ol>
                        <button onclick="this.parentElement.remove()" class="btn btn-primary mt-2">Entendido</button>
                    </div>
                `;
            }
            
            // üöÄ REEMPLAZAR EL BOT√ìN CON LAS INSTRUCCIONES
            const installSection = document.getElementById('pwa-install-section');
            if (installSection) {
                installSection.innerHTML = instructions;
            }
        }
        
        // üöÄ CARGAR ESTAD√çSTICAS POR DEFECTO (CUANDO PWA NO EST√Å DISPONIBLE)
        function cargarEstadisticasPorDefecto() {
            console.log('üöÄ Cargando estad√≠sticas por defecto...');
            estadisticas = { totalJugadores: 0, totalArqueros: 0, totalPartidos: 0 };
            actualizarUI();
        }
        
        // üöÄ CARGAR ESTAD√çSTICAS DESDE INDEXEDDB (100% OFFLINE)
        async function cargarEstadisticasOffline() {
            try {
                // üöÄ VERIFICAR QUE OFFLINE MANAGER EST√â DISPONIBLE
                if (!window.offlineManager) {
                    console.warn('‚ö†Ô∏è Offline Manager no disponible, usando datos por defecto');
                    return;
                }
                
                estadisticas = await window.offlineManager.getEstadisticas();
                console.log('üöÄ Estad√≠sticas cargadas desde IndexedDB:', estadisticas);
                
            } catch (error) {
                console.error('‚ùå Error cargando estad√≠sticas offline:', error);
                estadisticas = { totalJugadores: 0, totalArqueros: 0, totalPartidos: 0 };
            }
        }
        
        // üöÄ ACTUALIZAR UI CON ESTAD√çSTICAS
        function actualizarUI() {
            const totalJugadoresElement = document.getElementById('totalJugadores');
            const totalArquerosElement = document.getElementById('totalArqueros');
            const totalPartidosElement = document.getElementById('totalPartidos');
            
            if (totalJugadoresElement) totalJugadoresElement.textContent = estadisticas.totalJugadores;
            if (totalArquerosElement) totalArquerosElement.textContent = estadisticas.totalArqueros;
            if (totalPartidosElement) totalPartidosElement.textContent = estadisticas.totalPartidos;
        }
        
        // üöÄ EXPORTAR FUNCIONES PARA USO GLOBAL
        window.cargarEstadisticasOffline = cargarEstadisticasOffline;
        window.actualizarUI = actualizarUI;
        window.waitForPWAComponents = waitForPWAComponents;
    </script>
</body>
</html>
