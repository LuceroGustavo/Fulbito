
<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- üöÄ PWA META TAGS -->
    <meta name="theme-color" content="#4CAF50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Fulbito">
    
    <!-- üöÄ PWA MANIFEST -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- üöÄ PWA ICONS -->
    <link rel="icon" type="image/png" sizes="32x32" href="/img/icons/icon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/img/icons/icon-180x180.png">
    
    <title>Formar Equipos - Fulbito</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .page-container {
            background: 
                /* C√©sped base */
                linear-gradient(135deg, #2d5a27 0%, #1e3a1a 50%, #2d5a27 100%),
                /* Textura de c√©sped */
                repeating-linear-gradient(
                    90deg,
                    transparent 0px,
                    transparent 2px,
                    rgba(255, 255, 255, 0.03) 2px,
                    rgba(255, 255, 255, 0.03) 4px
                ),
                repeating-linear-gradient(
                    0deg,
                    transparent 0px,
                    transparent 2px,
                    rgba(255, 255, 255, 0.02) 2px,
                    rgba(255, 255, 255, 0.02) 4px
                ),
                /* L√≠neas de campo */
                linear-gradient(90deg, 
                    transparent 0%, 
                    transparent 45%, 
                    rgba(255, 255, 255, 0.8) 45%, 
                    rgba(255, 255, 255, 0.8) 55%, 
                    transparent 55%, 
                    transparent 100%
                ),
                linear-gradient(0deg, 
                    transparent 0%, 
                    transparent 45%, 
                    rgba(255, 255, 255, 0.8) 45%, 
                    rgba(255, 255, 255, 0.8) 55%, 
                    transparent 55%, 
                    transparent 100%
                );
            background-size: 
                100% 100%,
                8px 8px,
                8px 8px,
                100% 100%,
                100% 100%;
            min-height: 100vh;
            padding: 2rem 0;
            position: relative;
            overflow-x: hidden;
        }
        
        /* C√≠rculo central de la cancha */
        .page-container::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            border: 3px solid rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            z-index: 0;
        }
        
        /* √Åreas de penal */
        .page-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                /* √Årea penal superior */
                linear-gradient(90deg, 
                    transparent 0%, 
                    transparent 40%, 
                    rgba(255, 255, 255, 0.3) 40%, 
                    rgba(255, 255, 255, 0.3) 60%, 
                    transparent 60%, 
                    transparent 100%
                ),
                /* √Årea penal inferior */
                linear-gradient(90deg, 
                    transparent 0%, 
                    transparent 40%, 
                    rgba(255, 255, 255, 0.3) 40%, 
                    rgba(255, 255, 255, 0.3) 60%, 
                    transparent 60%, 
                    transparent 100%
                );
            background-size: 100% 50%, 100% 50%;
            background-position: 0 0, 0 100%;
            background-repeat: no-repeat;
            z-index: 0;
            pointer-events: none;
        }
        .form-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            position: relative;
            z-index: 1;
        }
        .form-header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px 15px 0 0;
            padding: 1.5rem;
        }
        .btn-custom {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 15px 40px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 1.1rem;
        }
        .btn-custom:hover {
            background: linear-gradient(45deg, #5a6fd8, #6a4190);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        .info-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            position: relative;
            z-index: 1;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }
        .stat-item {
            text-align: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .jugador-card {
            transition: all 0.3s ease;
            border: 2px solid #e9ecef;
        }
        
        .jugador-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-color: #007bff;
        }
        
        .jugador-card .form-check-input:checked + .form-check-label {
            color: #007bff;
            font-weight: bold;
        }
        
        .jugador-card .form-check-input:checked {
            background-color: #007bff;
            border-color: #007bff;
        }
        
        .jugador-card.arquero {
            border-color: #ffc107;
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
        }
        
        .jugador-card.arquero .form-check-input:checked {
            background-color: #ffc107;
            border-color: #ffc107;
        }
        
        /* Estilos para filtros avanzados */
        .filtro-card {
            transition: all 0.3s ease;
        }
        
        .filtro-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .form-check-input:checked {
            background-color: #198754;
            border-color: #198754;
        }
        
        .form-check-input:checked + .form-check-label {
            color: #198754;
            font-weight: 600;
        }
        
        .btn-filtro {
            transition: all 0.3s ease;
        }
        
        .btn-filtro:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        /* Ocultar contenido de filtros por defecto */
        .filtros-contenido {
            display: none;
            transition: all 0.3s ease;
        }
        
        /* Estilo para el mensaje de filtros ocultos */
        #mensajeFiltrosOcultos {
            transition: all 0.3s ease;
        }
        
        /* Elementos decorativos de f√∫tbol */
        .soccer-decoration {
            position: absolute;
            opacity: 0.1;
            z-index: 0;
            pointer-events: none;
        }
        
        .soccer-decoration.top-left {
            top: 20px;
            left: 20px;
            font-size: 4rem;
            color: rgba(255, 255, 255, 0.3);
        }
        
        .soccer-decoration.top-right {
            top: 20px;
            right: 20px;
            font-size: 4rem;
            color: rgba(255, 255, 255, 0.3);
        }
        
        .soccer-decoration.bottom-left {
            bottom: 20px;
            left: 20px;
            font-size: 4rem;
            color: rgba(255, 255, 255, 0.3);
        }
        
        .soccer-decoration.bottom-right {
            bottom: 20px;
            right: 20px;
            font-size: 4rem;
            color: rgba(255, 255, 255, 0.3);
        }
        
        /* Mejorar contraste del texto sobre el fondo verde */
        .text-dark {
            color: #1a1a1a !important;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
        }
        
        .text-secondary {
            color: #2c3e50 !important;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
        }
        
        /* Animaciones para elementos decorativos */
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
        }
        
        .soccer-decoration {
            animation: float 6s ease-in-out infinite;
        }
        
        .soccer-decoration.top-left {
            animation-delay: 0s;
        }
        
        .soccer-decoration.top-right {
            animation-delay: 1.5s;
        }
        
        .soccer-decoration.bottom-left {
            animation-delay: 3s;
        }
        
        .soccer-decoration.bottom-right {
            animation-delay: 4.5s;
        }
        
        /* Part√≠culas flotantes para simular ambiente de estadio */
        .stadium-particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
            pointer-events: none;
        }
        
        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            animation: particle-float 8s linear infinite;
        }
        
        @keyframes particle-float {
            0% {
                transform: translateY(100vh) translateX(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) translateX(100px);
                opacity: 0;
            }
        }
        
        .jugador-card {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .jugador-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-color: #007bff;
        }
        
        .jugador-card:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark" style="background: rgba(33, 37, 41, 0.95) !important; backdrop-filter: blur(10px); border-bottom: 2px solid rgba(255, 255, 255, 0.1);">
        <div class="container">
            <a class="navbar-brand" href="/">
                    <img src="/img/logo.png" alt="Fulbito Logo" height="45">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/jugadores">
                            <i class="fas fa-users me-1"></i>Jugadores
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/equipos/formar">
                            <i class="fas fa-random me-1"></i>Formar Equipos
                        </a>
                    </li>
                    <li class="nav-item">
                                             <a class="nav-link" href="/partidos/historial">
                            <i class="fas fa-history me-1"></i>Historial
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="page-container">
        <!-- Contenedor de part√≠culas flotantes -->
        <div class="stadium-particles" id="stadiumParticles"></div>
        
        <!-- Elementos decorativos de f√∫tbol -->
        <div class="soccer-decoration top-left">
            <i class="fas fa-futbol"></i>
        </div>
        <div class="soccer-decoration top-right">
            <i class="fas fa-trophy"></i>
        </div>
        <div class="soccer-decoration bottom-left">
            <i class="fas fa-bullseye"></i>
        </div>
        <div class="soccer-decoration bottom-right">
            <i class="fas fa-medal"></i>
        </div>
        
        <div class="container">
            <!-- Header -->
            <div class="text-center mb-4">
                <h1 class="text-dark display-4 fw-bold">
                    <i class="fas fa-random me-3 text-primary"></i>Formar Equipos
                </h1>
                <p class="lead text-secondary">Configura tu partido y genera equipos balanceados autom√°ticamente</p>
            </div>

            <!-- Informaci√≥n del sistema -->
            <div class="info-card">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h4 class="mb-3">
                            <i class="fas fa-info-circle me-2"></i>Estado del Sistema
                        </h4>
                        <p class="mb-0">Revisa la informaci√≥n actual antes de formar los equipos</p>
                    </div>
                    <div class="col-md-4 text-center">
                        <i class="fas fa-chart-pie fa-3x opacity-75"></i>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number" th:text="${totalJugadores}">0</div>
                        <div class="stat-label">Jugadores Totales</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" th:text="${totalJugadores >= 4 ? 'Disponible' : 'Insuficiente'}">Disponible</div>
                        <div class="stat-label">Estado para Partido</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" th:text="${totalJugadores >= 4 ? 'S√≠' : 'No'}">S√≠</div>
                        <div class="stat-label">Puede Formar Equipos</div>
                    </div>
                </div>
            </div>

            <!-- Formulario para formar equipos -->
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="card form-card">
                        <div class="form-header text-center">
                            <h2 class="mb-0">
                                <i class="fas fa-cog me-2"></i>Configuraci√≥n del Partido
                            </h2>
                        </div>
                        
                        <div class="card-body p-4">
                                <!-- Informaci√≥n sobre el algoritmo -->
                                <div class="alert alert-info">
                                    <h6 class="alert-heading">
                                        <i class="fas fa-lightbulb me-2"></i>¬øC√≥mo funciona nuestro algoritmo?
                                    </h6>
                                    <ul class="mb-0">
                                        <li><strong>Balance autom√°tico:</strong> Los equipos se forman considerando las calificaciones de cada jugador</li>
                <li><strong>Balance por edades:</strong> Los jugadores de diferentes edades se distribuyen equitativamente para evitar equipos desbalanceados</li>
                                        <li><strong>Distribuci√≥n de arqueros:</strong> Si hay arqueros, se distribuyen equitativamente</li>
                                        <li><strong>Aleatoriedad:</strong> Cada partido tendr√° equipos diferentes para mayor variedad</li>
                                        <li><strong>Optimizaci√≥n:</strong> El sistema busca la menor diferencia posible entre equipos</li>
                                    </ul>
                                </div>
                                
                                <!-- Panel de Filtros Avanzados -->
                                <div class="card mt-4 filtro-card">
                                    <div class="card-header bg-success text-white">
                                        <h6 class="mb-0">
                                            <i class="fas fa-filter me-2"></i>Filtros Avanzados
                                            <small class="ms-2 opacity-75">(Opcional)</small>
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <!-- Mensaje cuando filtros est√°n ocultos -->
                                        <div class="text-center py-4" id="mensajeFiltrosOcultos">
                                            <div class="mb-3">
                                                <i class="fas fa-filter fa-3x text-success opacity-75"></i>
                                            </div>
                                            <h6 class="text-success mb-2">
                                                <strong>Filtros Avanzados Disponibles</strong>
                                            </h6>
                                            <p class="text-muted mb-3">
                                                Accede a opciones de filtrado por habilidad, edad, posici√≥n y rendimiento
                                            </p>
                                            <button type="button" class="btn btn-outline-success btn-sm" onclick="mostrarOcultarFiltros()">
                                                <i class="fas fa-eye me-1"></i>Ver Filtros
                                            </button>
                                        </div>
                                        
                                        <!-- Informaci√≥n sobre filtros -->
                                        <div class="alert alert-light border-success mb-3 filtros-contenido">
                                            <i class="fas fa-info-circle text-success me-2"></i>
                                            <strong>¬øC√≥mo usar los filtros?</strong> Selecciona las opciones que desees y los jugadores se filtrar√°n autom√°ticamente. 
                                            Puedes combinar m√∫ltiples filtros para encontrar exactamente los jugadores que necesitas.
                                        </div>
                                        
                                        <div class="row filtros-contenido">
                                            <!-- Filtro por Nivel de Habilidad -->
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label fw-bold">
                                                    <i class="fas fa-star me-1"></i>Nivel de Habilidad
                                                </label>
                                                <div class="form-check">
                                                    <input class="form-check-input filtro-habilidad" type="checkbox" value="principiante" id="filtroPrincipiante" checked>
                                                    <label class="form-check-label" for="filtroPrincipiante">
                                                        Principiante (1-4)
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input filtro-habilidad" type="checkbox" value="intermedio" id="filtroIntermedio" checked>
                                                    <label class="form-check-label" for="filtroIntermedio">
                                                        Intermedio (5-7)
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input filtro-habilidad" type="checkbox" value="avanzado" id="filtroAvanzado" checked>
                                                    <label class="form-check-label" for="filtroAvanzado">
                                                        Avanzado (8-10)
                                                    </label>
                                                </div>
                                            </div>
                                            
                                            <!-- Filtro por Rango de Edad -->
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label fw-bold">
                                                    <i class="fas fa-birthday-cake me-1"></i>Rango de Edad
                                                </label>
                                                <div class="form-check">
                                                    <input class="form-check-input filtro-edad" type="checkbox" value="joven" id="filtroJoven" checked>
                                                    <label class="form-check-label" for="filtroJoven">
                                                        J√≥venes (18-25)
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input filtro-edad" type="checkbox" value="intermedio-edad" id="filtroIntermedioEdad" checked>
                                                    <label class="form-check-label" for="filtroIntermedioEdad">
                                                        Intermedios (26-35)
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input filtro-edad" type="checkbox" value="experimentado" id="filtroExperimentado" checked>
                                                    <label class="form-check-label" for="filtroExperimentado">
                                                        Experimentados (36+)
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="row filtros-contenido">
                                            <!-- Filtro por Posici√≥n -->
                                            <div class="col-md-4 mb-3">
                                                <label class="form-label fw-bold">
                                                    <i class="fas fa-futbol me-1"></i>Posici√≥n
                                                </label>
                                                <div class="form-check">
                                                    <input class="form-check-input filtro-posicion" type="checkbox" value="arquero" id="filtroArquero" checked>
                                                    <label class="form-check-label" for="filtroArquero">
                                                        Arqueros
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input filtro-posicion" type="checkbox" value="campo" id="filtroCampo" checked>
                                                    <label class="form-check-label" for="filtroCampo">
                                                        Jugadores de Campo
                                                    </label>
                                                </div>
                                            </div>
                                            
                                            <!-- Filtro por Disponibilidad -->
                                            <div class="col-md-4 mb-3">
                                                <label class="form-label fw-bold">
                                                    <i class="fas fa-user-check me-1"></i>Disponibilidad
                                                </label>
                                                <div class="form-check">
                                                    <input class="form-check-input filtro-disponibilidad" type="checkbox" value="activo" id="filtroActivo" checked>
                                                    <label class="form-check-label" for="filtroActivo">
                                                        Activos
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input filtro-disponibilidad" type="checkbox" value="inactivo" id="filtroInactivo">
                                                    <label class="form-check-label" for="filtroInactivo">
                                                        Inactivos
                                                    </label>
                                                </div>
                                            </div>
                                            
                                            <!-- Filtro por Rendimiento -->
                                            <div class="col-md-4 mb-3">
                                                <label class="form-label fw-bold">
                                                    <i class="fas fa-chart-line me-1"></i>Rendimiento
                                                </label>
                                                <div class="form-check">
                                                    <input class="form-check-input filtro-rendimiento" type="checkbox" value="alto" id="filtroRendimientoAlto" checked>
                                                    <label class="form-check-label" for="filtroRendimientoAlto">
                                                        Alto (8-10)
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input filtro-rendimiento" type="checkbox" value="medio" id="filtroRendimientoMedio" checked>
                                                    <label class="form-check-label" for="filtroRendimientoMedio">
                                                        Medio (5-7)
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input filtro-rendimiento" type="checkbox" value="bajo" id="filtroRendimientoBajo" checked>
                                                    <label class="form-check-label" for="filtroRendimientoBajo">
                                                        Bajo (1-4)
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Botones de Filtros -->
                                        <div class="row filtros-contenido">
                                            <div class="col-12 text-center">
                                                <button type="button" class="btn btn-success me-2 btn-filtro" id="btnAplicarFiltros">
                                                    <i class="fas fa-filter me-1"></i>Aplicar Filtros
                                                </button>
                                                <button type="button" class="btn btn-outline-secondary btn-filtro" id="btnLimpiarFiltros">
                                                    <i class="fas fa-broom me-1"></i>Limpiar Filtros
                                                </button>
                                                <button type="button" class="btn btn-outline-info btn-filtro" id="btnMostrarOcultarFiltros">
                                                    <i class="fas fa-eye me-1"></i>Ver Filtros Avanzados
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <!-- Contador de jugadores filtrados -->
                                        <div class="row mt-3 filtros-contenido">
                                            <div class="col-12">
                                                <div class="alert alert-info text-center">
                                                    <i class="fas fa-info-circle me-2"></i>
                                                    <strong id="contadorFiltrados">0</strong> jugadores disponibles con los filtros aplicados
                                                    <br>
                                                    <small class="text-muted">
                                                        <i class="fas fa-filter me-1"></i>
                                                        <span id="filtrosActivosCount">0</span> filtros activos
                                                    </small>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Indicador de filtros activos -->
                                        <div class="row mt-2 filtros-contenido">
                                            <div class="col-12">
                                                <div class="d-flex flex-wrap justify-content-center gap-2" id="indicadorFiltrosActivos">
                                                    <!-- Los filtros activos se mostrar√°n aqu√≠ din√°micamente -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Lista de Jugadores Disponibles -->
                                <div class="card mt-4">
                                    <div class="card-header bg-primary text-white">
                                        <h6 class="mb-0">
                                            <i class="fas fa-users me-2"></i>Selecciona los Jugadores que Jugar√°n
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <div class="d-flex align-items-center">
                                                    <div class="badge bg-primary fs-6 me-2">
                                                        <i class="fas fa-users me-1"></i>
                                                        <span id="totalSeleccionados">0</span> seleccionados
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6 text-end">
                                                <button type="button" class="btn btn-sm btn-outline-secondary" id="btnSeleccionarTodos">
                                                    <i class="fas fa-check-double me-1"></i>Seleccionar Todos
                                                </button>
                                                <button type="button" class="btn btn-sm btn-outline-secondary" id="btnDeseleccionarTodos">
                                                    <i class="fas fa-times me-1"></i>Deseleccionar Todos
                                                </button>
                                            </div>
                                        </div>
                                        
                                                                        <div class="row" id="listaJugadores">
                                    <!-- Los jugadores se cargar√°n din√°micamente aqu√≠ -->
                                </div>
                                
                                <!-- Datos de jugadores para fallback (ocultos) -->
                                <script th:inline="javascript">
                                    // Datos de jugadores desde Thymeleaf como fallback
                                    const jugadoresThymeleaf = /*[[${jugadores}]]*/ [];
                                </script>

                                <!-- Validaciones -->
                                <div th:if="${totalJugadores < 4}" class="alert alert-warning">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    <strong>¬°Atenci√≥n!</strong> Necesitas al menos 4 jugadores registrados para formar equipos. 
                                    Actualmente tienes <span th:text="${totalJugadores}">0</span> jugadores.
                                </div>

                                <!-- Botones -->
                                <div class="text-center">
                                    <a href="/jugadores" class="btn btn-outline-secondary btn-lg me-3">
                                        <i class="fas fa-arrow-left me-2"></i>Volver a Jugadores
                                    </a>
                                    <button type="button" class="btn btn-success btn-lg" id="btnDashboardInteractivo"
                                            th:disabled="${totalJugadores < 4}">
                                        <i class="fas fa-users-cog me-2"></i>Crear Equipos
                                    </button>
                                </div>
                                
                                <!-- Informaci√≥n sobre el sistema -->
                                <div class="alert alert-info mt-4" role="alert">
                                    <h6><i class="fas fa-info-circle me-2"></i>¬øC√≥mo funciona?</h6>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <strong>Sistema Interactivo:</strong>
                                            <ul class="mb-0 small">
                                                <li>Selecciona los jugadores que participar√°n</li>
                                                <li>Forma equipos temporales con drag & drop</li>
                                                <li>Intercambia jugadores entre equipos</li>
                                                <li>Regenera equipos ilimitadamente</li>
                                                <li>Guarda solo cuando est√©s satisfecho</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Consejos adicionales -->
                         <div class="row mt-5">
                 <div class="col-lg-4">
                     <div class="card h-100 border-0 shadow-lg" style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border: 2px solid rgba(255, 255, 255, 0.3); position: relative; z-index: 1;">
                         <div class="card-body text-center">
                            <i class="fas fa-balance-scale fa-3x text-primary mb-3"></i>
                            <h5>Equipos Balanceados</h5>
                            <p class="text-muted">Nuestro algoritmo considera todas las habilidades para crear equipos lo m√°s parejos posible.</p>
                        </div>
                    </div>
                </div>
                                 <div class="col-lg-4">
                     <div class="card h-100 border-0 shadow-lg" style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border: 2px solid rgba(255, 255, 255, 0.3); position: relative; z-index: 1;">
                         <div class="card-body text-center">
                             <i class="fas fa-random fa-3x text-success mb-3"></i>
                             <h5>Formaci√≥n Aleatoria</h5>
                             <p class="text-muted">Cada partido tendr√° equipos diferentes, asegurando que todos jueguen con diferentes compa√±eros.</p>
                         </div>
                     </div>
                 </div>
                 <div class="col-lg-4">
                     <div class="card h-100 border-0 shadow-lg" style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border: 2px solid rgba(255, 255, 255, 0.3); position: relative; z-index: 1;">
                         <div class="card-body text-center">
                             <i class="fas fa-history fa-3x text-info mb-3"></i>
                             <h5>Historial Completo</h5>
                             <p class="text-muted">Todos los partidos se guardan para que puedas revisar el historial de equipos formados.</p>
                         </div>
                     </div>
                 </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Variables globales
        let jugadoresSeleccionados = [];
        let todosLosJugadores = [];
        let jugadoresFiltrados = [];
        let filtrosActivos = {
            habilidad: ['principiante', 'intermedio', 'avanzado'],
            edad: ['joven', 'intermedio-edad', 'experimentado'],
            posicion: ['arquero', 'campo'],
            disponibilidad: ['activo'],
            rendimiento: ['alto', 'medio', 'bajo']
        };
        
        // Cargar jugadores al iniciar la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            cargarJugadores();
            inicializarEventos();
            cargarFiltrosGuardados();
            crearParticulasEstadio();
        });
        
        // Cargar lista de jugadores desde el servidor
        async function cargarJugadores() {
            try {
                const response = await fetch('/jugadores/api/todos');
                if (response.ok) {
                    todosLosJugadores = await response.json();
                    renderizarListaJugadores();
                } else {
                    console.error('Error al cargar jugadores');
                }
            } catch (error) {
                console.error('Error:', error);
                // Fallback: usar datos de Thymeleaf si est√°n disponibles
                if (typeof jugadoresThymeleaf !== 'undefined') {
                    todosLosJugadores = jugadoresThymeleaf;
                    renderizarListaJugadores();
                }
            }
        }
        
        // Renderizar la lista de jugadores
        function renderizarListaJugadores() {
            const container = document.getElementById('listaJugadores');
            container.innerHTML = '';
            
            // Aplicar filtros antes de renderizar
            jugadoresFiltrados = aplicarFiltros(todosLosJugadores);
            
            if (jugadoresFiltrados.length === 0) {
                // Mostrar mensaje cuando no hay jugadores que coincidan con los filtros
                container.innerHTML = `
                    <div class="col-12 text-center">
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle fa-2x mb-3"></i>
                            <h5>No hay jugadores que coincidan con los filtros seleccionados</h5>
                            <p class="mb-3">Intenta ajustar los filtros o usar menos restricciones.</p>
                            <button type="button" class="btn btn-outline-warning" onclick="limpiarFiltros()">
                                <i class="fas fa-broom me-1"></i>Limpiar Filtros
                            </button>
                        </div>
                    </div>
                `;
            } else {
                jugadoresFiltrados.forEach(jugador => {
                    const jugadorCard = crearTarjetaJugador(jugador);
                    container.appendChild(jugadorCard);
                });
            }
            
            // Actualizar contador de filtrados
            actualizarContadorFiltrados();
        }
        
        // Crear tarjeta de jugador individual
        function crearTarjetaJugador(jugador) {
            const col = document.createElement('div');
            col.className = 'col-md-6 col-lg-4 mb-3';
            
            const card = document.createElement('div');
            card.className = 'card h-100 jugador-card';
            card.setAttribute('data-jugador-id', jugador.id);
            
            const isArquero = jugador.esArquero ? 'arquero' : '';
            
            card.innerHTML = `
                <div class="card-body p-3">
                    ${jugador.esArquero ? '<div class="text-center mb-2"><span class="badge bg-warning text-dark fs-6">ü•Ö Arquero</span></div>' : ''}
                    <div class="form-check">
                        <input class="form-check-input jugador-checkbox" type="checkbox" 
                               value="${jugador.id}" id="jugador_${jugador.id}">
                        <label class="form-check-label" for="jugador_${jugador.id}">
                            <strong>${jugador.nombre}</strong>
                        </label>
                    </div>
                    <div class="mt-2">
                        <small class="text-muted">
                            <i class="fas fa-star me-1"></i>${jugador.calificacionTotal}
                            <span class="ms-2">${jugador.edad} a√±os</span>
                        </small>
                    </div>
                    <div class="mt-1">
                        <small class="text-muted">
                            <i class="fas fa-running me-1"></i>${jugador.velocidad}
                            <i class="fas fa-magic me-1 ms-1"></i>${jugador.habilidad}
                            <i class="fas fa-dumbbell me-1 ms-1"></i>${jugador.fuerzaFisica}
                            <i class="fas fa-bullseye me-1 ms-1"></i>${jugador.tiro}
                            <i class="fas fa-chess me-1 ms-1"></i>${jugador.tactica}
                        </small>
                    </div>
                </div>
            `;
            
            // Hacer que toda la tarjeta sea clickeable
            card.addEventListener('click', function(e) {
                // No activar si se hace clic en el checkbox o label
                if (e.target.type === 'checkbox' || e.target.tagName === 'LABEL') {
                    return;
                }
                
                const checkbox = this.querySelector('.jugador-checkbox');
                checkbox.checked = !checkbox.checked;
                actualizarSeleccion();
            });
            
            col.appendChild(card);
            return col;
        }
        
        // Funci√≥n para aplicar filtros a los jugadores
        function aplicarFiltros(jugadores) {
            return jugadores.filter(jugador => {
                // Filtro por nivel de habilidad
                const nivelHabilidad = obtenerNivelHabilidad(jugador.calificacionTotal);
                if (!filtrosActivos.habilidad.includes(nivelHabilidad)) {
                    return false;
                }
                
                // Filtro por rango de edad
                const rangoEdad = obtenerRangoEdad(jugador.edad);
                if (!filtrosActivos.edad.includes(rangoEdad)) {
                    return false;
                }
                
                // Filtro por posici√≥n
                const posicion = jugador.esArquero ? 'arquero' : 'campo';
                if (!filtrosActivos.posicion.includes(posicion)) {
                    return false;
                }
                
                // Filtro por disponibilidad (por ahora todos son activos)
                if (!filtrosActivos.disponibilidad.includes('activo')) {
                    return false;
                }
                
                // Filtro por rendimiento
                const nivelRendimiento = obtenerNivelRendimiento(jugador.calificacionTotal);
                if (!filtrosActivos.rendimiento.includes(nivelRendimiento)) {
                    return false;
                }
                
                return true;
            });
        }
        
        // Funci√≥n para obtener nivel de habilidad basado en calificaci√≥n
        function obtenerNivelHabilidad(calificacion) {
            if (calificacion >= 1 && calificacion <= 4) return 'principiante';
            if (calificacion >= 5 && calificacion <= 7) return 'intermedio';
            if (calificacion >= 8 && calificacion <= 10) return 'avanzado';
            return 'intermedio';
        }
        
        // Funci√≥n para obtener rango de edad
        function obtenerRangoEdad(edad) {
            if (edad >= 18 && edad <= 25) return 'joven';
            if (edad >= 26 && edad <= 35) return 'intermedio-edad';
            if (edad >= 36) return 'experimentado';
            return 'intermedio-edad';
        }
        
        // Funci√≥n para obtener nivel de rendimiento
        function obtenerNivelRendimiento(calificacion) {
            if (calificacion >= 8 && calificacion <= 10) return 'alto';
            if (calificacion >= 5 && calificacion <= 7) return 'medio';
            if (calificacion >= 1 && calificacion <= 4) return 'bajo';
            return 'medio';
        }
        
        // Funci√≥n para actualizar contador de filtrados
        function actualizarContadorFiltrados() {
            const contador = document.getElementById('contadorFiltrados');
            const filtrosCount = document.getElementById('filtrosActivosCount');
            
            if (contador) {
                contador.textContent = jugadoresFiltrados.length;
            }
            
            if (filtrosCount) {
                const totalFiltros = Object.values(filtrosActivos).reduce((total, filtros) => total + filtros.length, 0);
                filtrosCount.textContent = totalFiltros;
            }
            
            // Actualizar indicador visual de filtros activos
            actualizarIndicadorFiltrosActivos();
        }
        
        // Funci√≥n para mostrar filtros activos visualmente
        function actualizarIndicadorFiltrosActivos() {
            const container = document.getElementById('indicadorFiltrosActivos');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Crear badges para cada filtro activo
            Object.entries(filtrosActivos).forEach(([categoria, filtros]) => {
                filtros.forEach(filtro => {
                    const badge = document.createElement('span');
                    badge.className = 'badge bg-success text-white';
                    badge.innerHTML = `
                        <i class="fas fa-filter me-1"></i>
                        ${obtenerNombreFiltro(categoria, filtro)}
                        <button type="button" class="btn-close btn-close-white ms-2" 
                                onclick="desactivarFiltro('${categoria}', '${filtro}')" 
                                style="font-size: 0.5rem;"></button>
                    `;
                    container.appendChild(badge);
                });
            });
        }
        
        // Funci√≥n para obtener nombre legible del filtro
        function obtenerNombreFiltro(categoria, valor) {
            const nombres = {
                habilidad: {
                    'principiante': 'Principiante',
                    'intermedio': 'Intermedio',
                    'avanzado': 'Avanzado'
                },
                edad: {
                    'joven': 'J√≥venes',
                    'intermedio-edad': 'Intermedios',
                    'experimentado': 'Experimentados'
                },
                posicion: {
                    'arquero': 'Arqueros',
                    'campo': 'Campo'
                },
                disponibilidad: {
                    'activo': 'Activos',
                    'inactivo': 'Inactivos'
                },
                rendimiento: {
                    'alto': 'Alto',
                    'medio': 'Medio',
                    'bajo': 'Bajo'
                }
            };
            
            return nombres[categoria]?.[valor] || valor;
        }
        
        // Funci√≥n para desactivar un filtro espec√≠fico
        function desactivarFiltro(categoria, valor) {
            // Remover el valor del filtro
            const index = filtrosActivos[categoria].indexOf(valor);
            if (index > -1) {
                filtrosActivos[categoria].splice(index, 1);
            }
            
            // Actualizar la UI
            const checkbox = document.querySelector(`[value="${valor}"]`);
            if (checkbox) {
                checkbox.checked = false;
            }
            
            // Re-renderizar
            renderizarListaJugadores();
        }
        
        // Funci√≥n para actualizar filtros activos
        function actualizarFiltrosActivos() {
            // Filtros de habilidad
            filtrosActivos.habilidad = [];
            document.querySelectorAll('.filtro-habilidad:checked').forEach(cb => {
                filtrosActivos.habilidad.push(cb.value);
            });
            
            // Filtros de edad
            filtrosActivos.edad = [];
            document.querySelectorAll('.filtro-edad:checked').forEach(cb => {
                filtrosActivos.edad.push(cb.value);
            });
            
            // Filtros de posici√≥n
            filtrosActivos.posicion = [];
            document.querySelectorAll('.filtro-posicion:checked').forEach(cb => {
                filtrosActivos.posicion.push(cb.value);
            });
            
            // Filtros de disponibilidad
            filtrosActivos.disponibilidad = [];
            document.querySelectorAll('.filtro-disponibilidad:checked').forEach(cb => {
                filtrosActivos.disponibilidad.push(cb.value);
            });
            
            // Filtros de rendimiento
            filtrosActivos.rendimiento = [];
            document.querySelectorAll('.filtro-rendimiento:checked').forEach(cb => {
                filtrosActivos.rendimiento.push(cb.value);
            });
            
            // Guardar filtros en localStorage
            guardarFiltros();
        }
        
        // Funci√≥n para guardar filtros en localStorage
        function guardarFiltros() {
            try {
                localStorage.setItem('fulbito_filtros', JSON.stringify(filtrosActivos));
            } catch (error) {
                console.log('No se pudieron guardar los filtros en localStorage');
            }
        }
        
        // Funci√≥n para cargar filtros guardados
        function cargarFiltrosGuardados() {
            try {
                const filtrosGuardados = localStorage.getItem('fulbito_filtros');
                if (filtrosGuardados) {
                    filtrosActivos = JSON.parse(filtrosGuardados);
                    aplicarFiltrosGuardados();
                }
            } catch (error) {
                console.log('No se pudieron cargar los filtros guardados');
            }
        }
        
        // Funci√≥n para aplicar filtros guardados a la UI
        function aplicarFiltrosGuardados() {
            // Aplicar filtros de habilidad
            document.querySelectorAll('.filtro-habilidad').forEach(cb => {
                cb.checked = filtrosActivos.habilidad.includes(cb.value);
            });
            
            // Aplicar filtros de edad
            document.querySelectorAll('.filtro-edad').forEach(cb => {
                cb.checked = filtrosActivos.edad.includes(cb.value);
            });
            
            // Aplicar filtros de posici√≥n
            document.querySelectorAll('.filtro-posicion').forEach(cb => {
                cb.checked = filtrosActivos.posicion.includes(cb.value);
            });
            
            // Aplicar filtros de disponibilidad
            document.querySelectorAll('.filtro-disponibilidad').forEach(cb => {
                cb.checked = filtrosActivos.disponibilidad.includes(cb.value);
            });
            
            // Aplicar filtros de rendimiento
            document.querySelectorAll('.filtro-rendimiento').forEach(cb => {
                cb.checked = filtrosActivos.rendimiento.includes(cb.value);
            });
        }
        
        // Inicializar eventos
        function inicializarEventos() {
            // Event listener para checkboxes de jugadores
            document.addEventListener('change', function(e) {
                if (e.target.classList.contains('jugador-checkbox')) {
                    actualizarSeleccion();
                }
            });
            
            // Bot√≥n seleccionar todos
            document.getElementById('btnSeleccionarTodos').addEventListener('click', seleccionarTodos);
            
            // Bot√≥n deseleccionar todos
            document.getElementById('btnDeseleccionarTodos').addEventListener('click', deseleccionarTodos);
            
            // Bot√≥n dashboard interactivo
            document.getElementById('btnDashboardInteractivo').addEventListener('click', irADashboardInteractivo);
            
            // Event listeners para filtros
            document.getElementById('btnAplicarFiltros').addEventListener('click', aplicarFiltrosYRenderizar);
            document.getElementById('btnLimpiarFiltros').addEventListener('click', limpiarFiltros);
            document.getElementById('btnMostrarOcultarFiltros').addEventListener('click', mostrarOcultarFiltros);
            
            // Event listeners para cambios en filtros
            document.querySelectorAll('.filtro-habilidad, .filtro-edad, .filtro-posicion, .filtro-disponibilidad, .filtro-rendimiento').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    actualizarFiltrosActivos();
                    aplicarFiltrosYRenderizar();
                });
            });
        }
        
        // Funci√≥n para aplicar filtros y renderizar
        function aplicarFiltrosYRenderizar() {
            actualizarFiltrosActivos();
            renderizarListaJugadores();
        }
        
        // Funci√≥n para limpiar filtros
        function limpiarFiltros() {
            // Restaurar todos los filtros a checked
            document.querySelectorAll('.filtro-habilidad, .filtro-edad, .filtro-posicion, .filtro-disponibilidad, .filtro-rendimiento').forEach(checkbox => {
                checkbox.checked = true;
            });
            
            // Restaurar filtros activos por defecto
            filtrosActivos = {
                habilidad: ['principiante', 'intermedio', 'avanzado'],
                edad: ['joven', 'intermedio-edad', 'experimentado'],
                posicion: ['arquero', 'campo'],
                disponibilidad: ['activo'],
                rendimiento: ['alto', 'medio', 'bajo']
            };
            
            // Re-renderizar lista
            renderizarListaJugadores();
        }
        
        // Funci√≥n para mostrar/ocultar filtros
        function mostrarOcultarFiltros() {
            const elementosFiltros = document.querySelectorAll('.filtros-contenido');
            const mensajeOcultos = document.getElementById('mensajeFiltrosOcultos');
            const btn = document.getElementById('btnMostrarOcultarFiltros');
            
            if (elementosFiltros[0].style.display === 'none' || elementosFiltros[0].style.display === '') {
                // Mostrar filtros
                elementosFiltros.forEach(elemento => {
                    elemento.style.display = 'block';
                });
                mensajeOcultos.style.display = 'none';
                btn.innerHTML = '<i class="fas fa-eye-slash me-1"></i>Ocultar Filtros';
                btn.className = 'btn btn-outline-warning btn-filtro';
            } else {
                // Ocultar filtros
                elementosFiltros.forEach(elemento => {
                    elemento.style.display = 'none';
                });
                mensajeOcultos.style.display = 'block';
                btn.innerHTML = '<i class="fas fa-eye me-1"></i>Ver Filtros Avanzados';
                btn.className = 'btn btn-outline-info btn-filtro';
            }
        }
        
        // Actualizar selecci√≥n de jugadores
        function actualizarSeleccion() {
            const checkboxes = document.querySelectorAll('.jugador-checkbox:checked');
            jugadoresSeleccionados = Array.from(checkboxes).map(cb => parseInt(cb.value));
            
            document.getElementById('totalSeleccionados').textContent = jugadoresSeleccionados.length;
            
            // Habilitar/deshabilitar botones seg√∫n selecci√≥n
            const btnDashboard = document.getElementById('btnDashboardInteractivo');
            btnDashboard.disabled = jugadoresSeleccionados.length < 4;
        }
        
        // Seleccionar todos los jugadores
        function seleccionarTodos() {
            document.querySelectorAll('.jugador-checkbox').forEach(cb => {
                cb.checked = true;
            });
            actualizarSeleccion();
        }
        
        // Deseleccionar todos los jugadores
        function deseleccionarTodos() {
            document.querySelectorAll('.jugador-checkbox').forEach(cb => {
                cb.checked = false;
            });
            actualizarSeleccion();
        }
        
        // Ir al dashboard interactivo
        function irADashboardInteractivo() {
            if (jugadoresSeleccionados.length < 4) {
                alert('Necesitas seleccionar al menos 4 jugadores para formar equipos.');
                return;
            }
            
            // Generar sessionId √∫nico
            const sessionId = generarSessionId();
            
            // Crear URL con par√°metros
            const url = `/equipos/formar-temporales?cantidadJugadores=${jugadoresSeleccionados.length}&sessionId=${sessionId}&jugadores=${jugadoresSeleccionados.join(',')}`;
            
            // Redirigir al dashboard
            window.location.href = url;
        }
        
        // Generar sessionId √∫nico
        function generarSessionId() {
            const timestamp = Date.now();
            const random = Math.random().toString(36).substring(2, 15);
            return `session_${timestamp}_${random}`;
        }
        
        // Funci√≥n para crear part√≠culas del estadio
        function crearParticulasEstadio() {
            const container = document.getElementById('stadiumParticles');
            if (!container) return;
            
            // Crear 20 part√≠culas
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // Posici√≥n aleatoria
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 8 + 's';
                particle.style.animationDuration = (Math.random() * 4 + 6) + 's';
                
                container.appendChild(particle);
            }
        }
        
        // üöÄ PWA INITIALIZATION
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar si PWA est√° disponible
            if ('serviceWorker' in navigator) {
                console.log('üöÄ PWA disponible en Formar Equipos');
            }
        });

    </script>
    
    <!-- üöÄ PWA JAVASCRIPT FILES -->
    <script src="/js/offline-manager.js"></script>
    <script src="/js/pwa-installer.js"></script>
    <script src="/js/mobile-features.js"></script>
    <script src="/js/pwa-main.js"></script>
</body>
</html>
